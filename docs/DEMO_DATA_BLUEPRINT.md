# 📊 GrindLab Demo Data Blueprint

> **Документ управления макетом демонстрационных данных для презентаций продукта**
>
> ⚠️ **ВАЖНО**: Этот документ требует постоянной актуализации при добавлении новых фич и расширении функционала.

---

## 🎯 Назначение

Макет демонстрационных данных используется для:
- ✅ Презентаций продукта клиентам и инвесторам
- ✅ Smoke-тестирования основного функционала
- ✅ Разработки новых фич (как базис для тестирования)
- ✅ Документирования использования API
- ✅ Обучения пользователей

---

## 📋 Структура демонстрационных данных

### Уровень 1: Организационная иерархия

#### 🏭 Растения (Plants)

| Код | Название | Назначение |
|-----|----------|-----------|
| **GOLD-1** | Золотоизвлекательная фабрика №1 | Основной пример, схема SAG/SABC |
| **CUZN-2** | ЗИФ 2,5 | Пример Cu-Zn обогащения |
| **FE-3** | Железорудная фабрика №3 | Альтернативный минерал |

**Статус**: 3 растения создано, готово к расширению

---

### Уровень 2: Схемы и версии

#### 🔗 Flowsheet структура для GOLD-1

```
GOLD-1 (Plant)
├── Схема измельчения 1 (SAG)
│   ├── Базовая v1 [ACTIVE] ← Основная демо
│   └── Оптимизация v2 [ACTIVE] ← Улучшенная версия
└── Схема измельчения 2 (SABC)
    └── SABC v1 [DRAFT] ← Черновик для демонстрации Draft состояния
```

#### 📊 Flowsheet версии

| Версия | Статус | Описание | Сценарии |
|--------|--------|---------|----------|
| gold_base_v1 | ACTIVE | Базовая модель с реальными параметрами SAG | 3 |
| gold_opt_v2 | ACTIVE | Оптимизационная версия (энергия/производительность) | 3 |
| gold_sabc_v1 | DRAFT | SABC концепция (демонстрация Draft status) | 0 |
| cuzn_v1 | ACTIVE | Cu-Zn версия (альтернативный минерал) | 3 |
| fe_v1 | ACTIVE | Fe версия (железная руда) | 3 |

---

### Уровень 3: Проекты

#### 💼 Проекты что-если анализа

| Проект | Описание | Версии | Цель демонстрации |
|--------|---------|--------|-------------------|
| **Тестовый проект 1** | Базовое введение в систему | gold_base_v1, gold_opt_v2 | Начальное ознакомление, создание сценариев |
| **Оптимизация энергопотребления** | Поиск режима с минимальной энергией | gold_base_v1, gold_opt_v2 | Что-если анализ, сравнение метрик |
| **Summary No Runs** | Проект без расчётов | gold_base_v1 | Демонстрация пустого состояния UI |

---

### Уровень 4: Сценарии и расчёты

#### 🎬 Демонстрационные сценарии

Для каждой версии создано **3 сценария** с различными KPI:

**Базовая версия (gold_base_v1):**

| Сценарий | Производительность, т/ч | P80 продукта, мм | Удельная энергия, кВт/т | Циркуляционная нагрузка, % | Цель демо |
|----------|------------------------|-----------------|------------------------|---------------------------|-----------|
| 🔵 Базовый | 540 | 0.184 | 13.3 | 250 | Исходное состояние |
| 🟢 Снижение энергии | 500 | 0.184 | 12.0 | 250 | Оптимизация по энергии |
| 🔴 Рост производительности | 580 | 0.184 | 14.0 | 270 | Максимальная мощность |

**Оптимизированная версия (gold_opt_v2):**
- Те же сценарии с улучшенными параметрами (±5%)
- Демонстрирует влияние версии на результаты

---

## 📐 Параметры демо-расчёта

### Входные параметры (CalcInput)

```json
{
  "model_version": "grind_mvp_v1",
  "feed_tph": 500.0,
  "target_p80_microns": 180.0,
  "ore_hardness_ab": 12.5,
  "ore_hardness_ta": 24.8,
  "water_fraction": 0.15,

  "feed": {
    "tonnage_tph": 500,
    "p80_mm": 0.18,
    "density_t_per_m3": 2.6
  },

  "mill": {
    "type": "SAG",
    "power_installed_kw": 15000,
    "power_draw_kw": 13000,
    "ball_charge_percent": 15,
    "speed_percent_critical": 75
  },

  "classifier": {
    "type": "Hydrocyclone",
    "cut_size_p80_mm": 0.18,
    "circulating_load_percent": 250
  },

  "fact_psd": {
    "points": [
      {"size_um": 1000, "pass_pct": 100},
      {"size_um": 500, "pass_pct": 95},
      {"size_um": 250, "pass_pct": 78},
      {"size_um": 180, "pass_pct": 50},
      {"size_um": 100, "pass_pct": 28},
      {"size_um": 50, "pass_pct": 10},
      {"size_um": 10, "pass_pct": 1}
    ],
    "p80_um": 190,
    "p50_um": 105
  }
}
```

### Выходные параметры (CalcResult)

```json
{
  "model_version": "grind_mvp_v1",
  "kpi": {
    "throughput_tph": 540.0,
    "product_p80_mm": 0.184,
    "specific_energy_kwh_per_t": 13.3,
    "circulating_load_percent": 250,
    "mill_utilization_percent": 92.0
  },
  "size_distribution": {
    "feed": [
      {"size_mm": 1.0, "cum_percent": 10},
      {"size_mm": 0.5, "cum_percent": 40},
      {"size_mm": 0.2, "cum_percent": 75}
    ],
    "product": [
      {"size_mm": 0.5, "cum_percent": 20},
      {"size_mm": 0.2, "cum_percent": 60},
      {"size_mm": 0.1, "cum_percent": 90}
    ]
  }
}
```

---

## 🔄 Типичный workflow демонстрации

### 1️⃣ Презентация (5 мин)
```
Home → Проекты → "Тестовый проект 1"
↓
Dashboard: 3 версии, 9 расчётов, базовый сценарий
↓
ScenarioComparePage: Базовый vs Сценарий 2
↓
KPI сравнение таблица (Fact vs Model, дельты)
↓
PSD графики (Cumulative passing %)
```

### 2️⃣ Что-если анализ (10 мин)
```
Проект: "Оптимизация энергопотребления"
↓
Создание нового сценария
↓
Запуск расчёта (batch-run для 3 сценариев)
↓
Сравнение KPI: energía 13.3 vs 12.0 vs 14.0 кВт/т
↓
Экспорт результатов
```

### 3️⃣ Калибровка (показ в будущем)
```
Загрузка фактических данных
↓
Автоматическая калибровка параметров
↓
Сравнение модели с фактом
```

---

## 📦 Семена данных (Seeds)

### Функция инициализации

**Файл**: `backend/app/demo_seed.py`

**Основные функции:**
- `seed_plants_and_flowsheets()` - 3 растения, 5 версий
- `seed_projects()` - 3 проекта
- `seed_project_flowsheet_links()` - связи проект ↔ версия
- `seed_grind_mvp_runs()` - 9 демо-расчётов

**Автоматический запуск:**
- При `python backend/app/demo_seed.py`
- При инициализации БД в conftest.py для тестов

### Идемпотентность

Все функции проверяют наличие данных перед созданием:
```python
existing = db.query(Model).filter_by(...).first()
if existing:
    continue  # Skip creation
```

✅ Безопасно вызывать многократно (данные не дублируются)

---

## 🎨 Визуальные примеры для демонстрации

### Dashboard (Project Summary)

```
┌─────────────────────────────────────────────┐
│ Тестовый проект 1                           │
│ ══════════════════════════════════════════════
│ Описание: Демонстрационный проект...        │
│                                               │
│ 📊 Статистика                               │
│ ├─ Версий: 2 (gold_base_v1, gold_opt_v2)    │
│ ├─ Сценариев: 6                             │
│ └─ Расчётов: 12                             │
│                                               │
│ 🎯 Последние успешные запуски               │
│ ├─ Базовый сценарий (540 т/ч, P80=184 мк)  │
│ ├─ Снижение энергии (500 т/ч, энергия 12)  │
│ └─ Рост производительности (580 т/ч)       │
│                                               │
│ [Запустить сценарий] [Создать сценарий]    │
└─────────────────────────────────────────────┘
```

### Scenario Comparison (ScenarioComparePage)

```
┌─────────────────────────────────────────────┐
│ Сравнение сценария с базовым                │
│ ══════════════════════════════════════════════
│ Сценарий: Снижение энергии                  │
│ Базовый: Базовый сценарий                   │
│                                               │
│ KPI сравнение:                              │
│ ┌──────────────────────────────────────────┐ │
│ │ Метрика               │ Базовый │ Сценарий│ │
│ ├──────────────────────┼─────────┼─────────┤ │
│ │ Производительность   │ 540     │ 500  ↓ 7%│ │
│ │ P80 продукта, мм     │ 0.184   │ 0.184  → │ │
│ │ Удельная энергия     │ 13.3    │ 12.0  ↓9%│ │
│ │ Циркуляция, %        │ 250     │ 250    → │ │
│ └──────────────────────┴─────────┴─────────┘ │
│                                               │
│ 📈 Кривые PSD                               │
│ ├─ Базовый: синяя линия                    │
│ └─ Сценарий: оранжевая линия                │
└─────────────────────────────────────────────┘
```

---

## 📅 Процесс актуализации

### Чеклист при добавлении новой фичи

- [ ] **F8.4 Export**: Добавить примеры экспортированных PNG/CSV файлов
- [ ] **F6.x Calibration**: Расширить с реальными данными калибровки
- [ ] **Batch runs**: ✅ Добавлены примеры batch-запусков
- [ ] **Audit log**: ✅ Демонстрировать изменения сценариев
- [ ] **Новые KPI**: Обновить таблицы результатов

### Расписание обновления

| График | Задача |
|--------|--------|
| **Каждая 2 недели** | Очистить старые расчёты, обновить временные метки |
| **Каждый месяц** | Проверить актуальность параметров (технологические стандарты) |
| **При новой версии** | Добавить пример использования новой фичи |
| **Перед презентацией** | Прогнать smoke-тесты, убедиться в корректности данных |

### Команды для обновления

```bash
# Полная переинициализация демо-данных
cd backend
python app/demo_seed.py

# Проверка целостности
python -m pytest scripts/smoke_api.py -v

# Экспорт результатов для документации
curl http://localhost:8000/api/projects/my -o demo_export.json
```

---

## 🔐 Безопасность демо-данных

### Что НЕ включать

❌ Реальные коммерческие данные фабрик
❌ Конфиденциальные параметры процессов
❌ Реальные контакты клиентов
❌ Пароли (использовать `demo/demo`)

### Что включать

✅ Типичные технологические параметры
✅ Реалистичные, но вымышленные названия растений
✅ Диапазоны KPI, соответствующие отрасли
✅ Репрезентативные сценарии оптимизации

---

## 📊 Метрики демо-данных

| Метрика | Значение |
|---------|----------|
| Растений | 3 |
| Цветочков (Flowsheets) | 4 |
| Версий | 5 |
| Проектов | 3 |
| Сценариев | 9 |
| Расчётов | ~27 |
| Размер БД | ~5 MB |
| Время инициализации | ~2 сек |

---

## 🚀 Интеграция с CI/CD

### GitHub Actions: Smoke-тесты демо

```yaml
name: Demo Data Verification
on: [push]
jobs:
  smoke-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Seed demo data
        run: python backend/app/demo_seed.py
      - name: Run smoke API tests
        run: python backend/scripts/smoke_api.py
```

---

## 📝 История версий

| Версия | Дата | Изменения |
|--------|------|-----------|
| v1.0 | 2025-12-25 | Базовая структура (3 растения, 5 версий, 9 расчётов) |
| v1.1 | 2025-12-27 | Добавлены batch-runs примеры |
| v2.0 | TBD | Интеграция Calibration и Export примеров |

---

## 📞 Ответственные лица

- **Куратор демо-данных**: DevOps/QA
- **Актуализация при новых фич**: Backend разработчик
- **Валидация перед презентацией**: Product Manager

---

**Документ требует актуализации при добавлении новых фич. Последнее обновление: 25 декабря 2025 г.**
