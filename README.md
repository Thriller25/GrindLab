# GrindLab — Comminution Modeling Module (MVP v1.0)

## Testing / Smoke checklist
`docs/testing.md` — единый чек-лист smoke/негативных сценариев и обязательные команды перед PR.

GrindLab — программный модуль моделирования и оптимизации цепочки дробления и измельчения (comminution) на обогатительных фабриках.

Данный репозиторий содержит исходный код и документацию для разработки MVP-версии GrindLab: конструктор схемы, калибровка моделей оборудования, сценарное моделирование и сравнение сценариев.

---

## 1. Структура репозитория (рекомендуемая)

```text
.
├── docs/
│   ├── PRD_GrindLab_MVP_v1.0.docx
│   ├── DB_Model_GrindLab_v1.0.docx
│   ├── Calc_API_GrindLab_v1.0.docx
│   ├── Equipment_Models_GrindLab_v1.0.docx
│   ├── Assumptions_GrindLab_v1.0.docx
│   └── Starter_Pack_GrindLab_MVP_v1.0.docx
├── backend/
│   └── ...  # исходный код backend-сервиса GrindLab
├── calc-service/
│   └── ...  # исходный код расчётного сервиса (Calc Service GrindLab)
├── frontend/
│   └── ...  # web-интерфейс инженера
└── README.md
```

Папка `docs/` содержит основную продуктово-техническую документацию для команды GrindLab.

---

## 2. Ключевые артефакты в docs/

- **PRD_GrindLab_MVP_v1.0.docx**  
  Product Requirements Document (PRD): цели и контекст продукта GrindLab, периметр MVP, пользователи, ключевые сценарии и экраны.

- **DB_Model_GrindLab_v1.0.docx**  
  Модель данных и схема БД для GrindLab: сущности (Plant, Flowsheet, FlowsheetVersion, Unit, Stream, CalibrationSet, Scenario, ScenarioResult и др.), поля, типы, связи и рекомендации по PostgreSQL.

- **Calc_API_GrindLab_v1.0.docx**  
  Спецификация API между backend и расчётным сервисом GrindLab (Calc Service): эндпоинты, структуры JSON-запросов/ответов, коды ошибок, правила версионирования.

- **Equipment_Models_GrindLab_v1.0.docx**  
  Спецификация моделей оборудования (SAG/ball/drobilki/циклоны), используемых в GrindLab: входные данные, калибруемые параметры, выходы, требования к данным для калибровки.

- **Assumptions_GrindLab_v1.0.docx**  
  Реестр допущений для GrindLab: по данным, моделям, архитектуре и функциональному объёму MVP (с приоритетами A/B/C и рекомендациями по пересмотру).

- **Starter_Pack_GrindLab_MVP_v1.0.docx**  
  Starter-пакет для команды разработки: краткое описание продукта GrindLab, перечень артефактов, архитектурные рамки, стартовые потоки работ и целевой сквозной сценарий.

---

## 3. Обзор продукта GrindLab

**Что мы строим**

GrindLab позволяет:

1. Собирать технологическую схему дробления–измельчения (flowsheet) для конкретной фабрики.
2. Откалибровать модели оборудования по историческим данным (через INKA/Data Hub).
3. Запускать сценарии «что если?» (изменение уставок, состава руды).
4. Сравнивать сценарии между собой и с фактическим режимом.

**Чего нет в GrindLab MVP**

- Онлайн-цифрового двойника в реальном времени.
- Автоматической записи уставок в MES/АСУТП.
- Полноценного модуля экономики (EBITDA/час и т.п.) — только задел в структуре данных.

---

## 4. Архитектура (high-level)

MVP GrindLab предполагает следующую целевую архитектуру:

- **frontend/** – web-интерфейс инженера (конструктор схем, калибровка, сценарии, сравнение).
- **backend/** – доменная логика, REST API, доступ к БД, сборка/разборка JSON для Calc Service.
- **calc-service/** – отдельный микросервис расчётного ядра GrindLab, реализующий Calc API v1.0.
- **PostgreSQL** – основная БД (uuid + jsonb).
- Интеграция с **INKA/Data Hub** – чтение исторических данных для калибровки и сравнения с фактом.

Детализация архитектуры находится в документах `PRD_*.docx`, `DB_Model_*.docx` и `Calc_API_*.docx`.

---

## 5. Как начать разработку GrindLab (рекомендуемый порядок)

1. **Ознакомиться со Starter-пакетом**  
   Открыть `docs/Starter_Pack_GrindLab_MVP_v1.0.docx` и получить общее представление о продукте и MVP.

2. **Изучить PRD и модель данных**  
   - `docs/PRD_GrindLab_MVP_v1.0.docx`  
   - `docs/DB_Model_GrindLab_v1.0.docx`

3. **Согласовать архитектурные решения по стеку**  
   На основе раздела «Архитектурные рамки» в Starter-пакете.

4. **Реализовать основу GrindLab:**
   - схему БД (по `DB_Model_*`),  
   - базовый backend с CRUD,  
   - Calc Service с stub-математикой по `Calc_API_*` и `Equipment_Models_*`,  
   - черновой frontend (3–5 ключевых экранов).

5. **Использовать `Assumptions_*.docx` как чек-лист рисков**  
   По мере получения реальных данных/обратной связи отмечать, какие допущения подтверждаются, а какие требуют изменений.

---

## 6. Версионирование

Версия документации и артефактов обозначается как `v1.x`.  

- Изменения, не ломающие обратную совместимость (добавление полей, уточнение формулировок) → `v1.1`, `v1.2` и т.д.  
- Несовместимые изменения структуры данных или Calc API → `v2.0` (с отдельным changelog).

---

## 7. Обратная связь и доработка

Любые изменения требований, модели данных, Calc API и моделей оборудования GrindLab должны отражаться:

1. В соответствующем документе в `docs/` с повышением версии.  
2. В этом `README.md` — кратким описанием изменений (ссылкой на changelog, если он будет добавлен).

## Backend (FastAPI, SQLite) — как запустить
1. Клонировать репозиторий и перейти в каталог backend: `git clone <repo_url> && cd GrindLab/backend`.
2. Создать и активировать виртуальное окружение (например, `.venv`).
3. Установить зависимости: `pip install -r requirements.txt`.
4. Скопировать `.env.example` в `.env` и при необходимости отредактировать параметры.
5. Запустить приложение: `.\.venv\Scripts\python.exe -m uvicorn app.main:app --reload`.
6. Открыть Swagger по адресу http://127.0.0.1:8000/docs.

По умолчанию используется SQLite-файл `grindlab.db` в папке `backend`.

## Backend (FastAPI, SQLite) — как запустить
1. Клонировать репозиторий и перейти в папку backend:
   - `cd backend`
2. Создать и активировать виртуальное окружение:
   - Windows: `python -m venv .venv` и `.venv\Scripts\activate`
   - macOS / Linux: `python3 -m venv .venv` и `source .venv/bin/activate`
3. Установить зависимости:
   - `pip install -r requirements.txt`
4. Создать файл `.env` на основе `.env.example`:
   - `copy .env.example .env` (или аналог для своей ОС)
   - при необходимости отредактировать значения DB_URL и APP_DEBUG.
5. Запустить backend:
   - убедиться, что текущая директория — `backend`
   - `uvicorn app.main:app --reload`
6. Открыть Swagger UI:
   - http://127.0.0.1:8000/docs

Dev-конфигурация использует SQLite-файл `grindlab.db` в папке `backend`.
